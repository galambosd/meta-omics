for S in $@
do
cd $S
anvi-gen-contigs-database -f MidCaymanRise_${S}_idba_assembly_fixed.fa --split-length -1 --external-gene-calls ~/file_org/sample_data/external_gene_calls/${S}_external_gene_calls_matrix.txt --ignore-internal-stop-codons -o ${S}_CONTIGS_external_calls.db
anvi-run-hmms -c *calls.db -T 4
anvi-import-functions -c *calls.db -i ~/file_org/MAG_data/anvio_bin_summary_new/${S}/*functions_matrix.txt
cd ..
done

galambosd@baross ~/file_org/mapping_data/RNA_mapping $ ./make_contigs_db_w_external_calls.sh FS844
Input FASTA file .............................: /Accounts/galambosd/file_org/mapping_data/RNA_mapping/FS844/MidCaymanRise_FS844_idba_assembly_fixed.fa

Anvi'o made things up for you
===============================================
You are generating a new anvi'o contigs database, but you are not specifying a
project name for it. FINE. Anvi'o, in desperation, will use the input file name
to set the project name for this contigs database (which is
'MidCaymanRise_FS844_idba_assembly_fixed'). If you are not happy with that, feel
free to kill and restart this process. If you are not happy with this name, but
you don't like killing things either, maybe next time you should either name
your FASTA files better, or use the `--project-name` parameter to set your
desired name.

Name .........................................: MidCaymanRise_FS844_idba_assembly_fixed
Description ..................................: No description is given
                                                                                                                                                                                                          [12 May 18 14:58:46 Checking deflines and contig lengths] tick tock ...                                                                                                                                                                                                                                                                                                                                             Split Length .................................: 9,223,372,036,854,775,807
K-mer size ...................................: 4
Skip gene calling? ...........................: False
External gene calls provided? ................: /Accounts/galambosd/file_org/sample_data/external_gene_calls/FS844_external_gene_calls_matrix.txt
Ignoring internal stop codons? ...............: True
Splitting pays attention to gene calls? ......: True
External gene calls ..........................: 245856 gene calls recovered and will be processed.
                                                                                                                                                                                                          [12 May 18 14:59:36 Processing] Entering 245856 gene calls into the db ...                                                                                                                                                                                                                                                                                                                                                                                                       
WARNING
===============================================
Please read this carefully: Your external gene calls contained open reading
frames with internal stop codons, and you asked anvi'o to ignore those. Anvi'o
replaced internal stop codons with 'X' characters, and stored them in the
contigs database that way. 805 of your genes, which corresponded to 0.33% of the
total 245856 genes, had internal stop codons. We hope you are happy.


at least one gene call ..........: 74996 of 75162 (99.8%)                         
Contigs database .............................: A new database, FS844_CONTIGS_external_calls.db, has been created.
Number of contigs ............................: 75,162
Number of splits .............................: 75,162
Total number of nucleotides ..................: 196,958,927
Gene calling step skipped ....................: False
Splits broke genes (non-mindful mode) ........: False
Desired split length (what the user wanted) ..: 9,223,372,036,854,775,807
Average split length (wnat anvi'o gave back) .: (Anvi'o did not create any splits)

                                                                                                                                                                        [12 May 18 15:07:31 Initializing the dictionary for gene calls] ...                                                                                                                                                                                                                                                                             Target found .................................: AA:GENE  


               Contigs DB ...................................: Initialized: FS844_CONTIGS_external_calls.db (v. 10)

HMM Profiling for Campbell_et_al
===============================================
Reference ....................................: Campbell et al, http://www.pnas.org/content/110/14/5540.short
Kind .........................................: singlecopy
Alphabet .....................................: AA
Context ......................................: GENE
Domain .......................................: bacteria
HMM model path ...............................: /usr/local/lib/python3.6/site-packages/anvio-4_master-py3.6-linux-x86_64.egg/anvio/data/hmm/Campbell_et_al/genes.hmm.gz
Number of genes ..............................: 139
Noise cutoff term(s) .........................: --cut_ga
Number of CPUs will be used for search .......: 50
Temporary work dir ...........................: /tmp/tmpx942myeh
HMM scan output ..............................: /tmp/tmpx942myeh/hmm.output
HMM scan hits ................................: /tmp/tmpx942myeh/hmm.hits
Log file .....................................: /tmp/tmpx942myeh/00_log.txt

                                                                                                                     Number of raw hits ...........................: 9,490                                          

HMM Profiling for Ribosomal_RNAs
===============================================
Reference ....................................: Seemann T, https://github.com/tseemann/barrnap
Kind .........................................: Ribosomal_RNAs
Alphabet .....................................: RNA
Context ......................................: CONTIG
Domain .......................................: N\A
HMM model path ...............................: /usr/local/lib/python3.6/site-packages/anvio-4_master-py3.6-linux-x86_64.egg/anvio/data/hmm/Ribosomal_RNAs/genes.hmm.gz
Number of genes ..............................: 12
Noise cutoff term(s) .........................: --cut_ga
Number of CPUs will be used for search .......: 50
Temporary work dir ...........................: /tmp/tmpt5_lg2kf
HMM scan output ..............................: /tmp/tmpt5_lg2kf/hmm.output
HMM scan hits ................................: /tmp/tmpt5_lg2kf/hmm.hits
Log file .....................................: /tmp/tmpt5_lg2kf/00_log.txt



                                                                                                                     Number of raw hits ...........................: 99                                             

Psst. Your fancy HMM profile 'Ribosomal_RNAs' speaking
===============================================
Alright! You just called an HMM profile that runs on contigs. Because it is not
working with anvi'o gene calls directly, the resulting hits will need to be
added as 'new gene calls' into the contigs database. This is a new feature, and
if it starts screwing things up for you please let us know. Other than that
you're pretty much golden. Carry on.

Pruned .......................................: 20 out of 99 hits were removed due to redundancy


Contigs with at least one gene call ..........: 75039 of 75162 (99.8%)



                                       Gene calls added to db .......................: 79 (from source "Ribosomal_RNAs")              

HMM Profiling for Rinke_et_al
===============================================
Reference ....................................: Rinke et al, http://www.nature.com/nature/journal/v499/n7459/full/nature12352.html
Kind .........................................: singlecopy
Alphabet .....................................: AA
Context ......................................: GENE
Domain .......................................: archaea
HMM model path ...............................: /usr/local/lib/python3.6/site-packages/anvio-4_master-py3.6-linux-x86_64.egg/anvio/data/hmm/Rinke_et_al/genes.hmm.gz
Number of genes ..............................: 162
Noise cutoff term(s) .........................: --cut_ga
Number of CPUs will be used for search .......: 50
Temporary work dir ...........................: /tmp/tmpxh3vthp6
HMM scan output ..............................: /tmp/tmpxh3vthp6/hmm.output
HMM scan hits ................................: /tmp/tmpxh3vthp6/hmm.hits
Log file .....................................: /tmp/tmpxh3vthp6/00_log.txt


Number of raw hits ...........................: 7,713                                          
Gene functions ...............................: 248623 function calls from 1 sources for 248623 unique gene calls has been added to the contigs database.
